/**
 * @author Ofek Gila
 * @since August 29th, 2016
 * @version September 1st, 2016
 */

var linkStrikes = parseInt(localStorage.getItem("linkStrikes")) || 0;

/**
 * If the page isn't youtube, change all links
 * (a tags) to break them randomly.
 */
if (window.location.href.indexOf("youtube") === -1)	{
	setInterval(changeLinks, 2000);
	changeLinks();
}

/**
 * Continuously tries changing links until they are broken.
 * Increment linkStrikes in local storage if clicked on broken
 * link.
 * @return {undefined}
 */
function changeLinks() {
	let links = document.getElementsByTagName('a');
	for (let i = 0; i < links.length; i++)
		if (!links[i].dataset.broken)	{
			let currLink = links[i].href;
			links[i].href = removeRandom(currLink);
			if (currLink !== links[i].href) {
				links[i].dataset.broken = true;
				links[i].addEventListener('click', function ()	{
					linkStrikes++;
					localStorage.setItem("linkStrikes", linkStrikes);
					window.confirm("Ofek strikes again!");
				});
			}
		}
}

/**
 * Removes a random character from a string.
 * @param  {String}
 * @return {String}
 */
function removeRandom(str) {
	let random = Math.floor(Math.random() * str.length);
	return str.substring(0, random) + str.substring(random + 1);
}
